# Network Services Inventory - Synology SRM RT6600ax

## Overview

This document provides a detailed inventory and operational guide for the network services running on the Synology Router Manager (SRM) platform, specifically for the RT6600ax model. SRM is built on a customized embedded Linux distribution, utilizing the Upstart init system and a proprietary service management layer (`synoservice`). Understanding the architecture, service dependencies, and key operational commands is critical for effective management, troubleshooting, and security hardening.

## Service Inventory

The following table details the primary network-facing and critical system services. While over 200 init scripts exist, this list focuses on services directly involved in network operations or system management.

| Service Name | Binary/Process | Default Port(s) | Protocol(s) | Exposure | Package/Component | Description & Operational Notes |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **SRM Web UI** | `httpd` (Apache) | 8000 (HTTP)<br>8001 (HTTPS) | TCP | LAN/WAN | `srm-app-portal` | The core management interface. Runs as a web application served by Apache. Access is controlled by the SRM firewall; WAN access is disabled by default. |
| **DNS / DHCP** | `dnsmasq` | 53 (DNS)<br>67 (DHCP) | UDP, TCP | LAN | `dnsmasq` | Manages all LAN-side DNS and DHCP services. Config is auto-generated by `synoservice` into `/etc/dnsmasq.conf`. **Do not edit this file directly.** Use `/var/log/dnsmasq.log` for troubleshooting. |
| **Firewall** | `iptables` | N/A | N/A | System | `iptables` | Kernel-level stateful firewall. Rules are dynamically generated by SRM. To inspect the live ruleset, use `iptables-save`. Custom rules are not officially supported and can be overwritten. |
| **SSH Access** | `sshd` | 22 | TCP | LAN | `sshd` | Secure shell access. Disabled by default. When enabled, it is a high-value target; use strong passwords/keys and limit access via the firewall. |
| **NTP Client** | `ntpd` | 123 | UDP | WAN | `ntp` | Synchronizes system time. Critical for logs, certs, and time-based rules. `ntpq -p` can be used to check peer status. |
| **Threat Prevention** | `suricata` | N/A | N/A | System | `SafeAccess-Suricata` | Intrusion Detection/Prevention System (IDS/IPS). Deep packet inspection engine. Can be resource-intensive. Logs are in `/var/packages/SafeAccess/target/suricata/log/`. |
| **VPN Plus Server** | `synovpnss` | various | TCP, UDP | WAN | `VPNPlusServer` | Hosts VPN servers (Synology SSL VPN, L2TP, OpenVPN). Opens ports on WAN when enabled. |
| **VPN Client** | `synovpnclient` | Various | TCP, UDP | WAN | `VPN-Client` | Manages outbound VPN connections. Modifies system routing table via `ip route`. Uses `/usr/syno/etc.defaults/synovpnclient/scripts/synovpnclient.sh` for control. |
| **File Services** | `smbd`, `nmbd` | 139, 445 | TCP | LAN | `samba` | Provides SMB/CIFS sharing for connected USB storage. `smbd` is the file server, `nmbd` handles NetBIOS name resolution. |
| **SNMP Agent** | `snmpd` | 161, 162 | UDP | LAN | `net-snmp` | Provides router metrics via SNMP. Disabled by default. Use SNMPv3 for security. |
| **Network Cfg Mgmt** | `syno-net-setting` | N/A | N/A | System | `srm-app-setting` | Core daemon that applies network configurations (interfaces, IPs, bridges, VLANs) from the UI into the running system. A dependency for almost all network services. |
| **System Logger** | `syslog-ng` | N/A | N/A | System | `syslog-ng` | Manages system-wide logging. Centralizes logs from various services into files like `/var/log/messages`. Crucial for all troubleshooting. |
| **Wi-Fi Service** | `hostapd` | N/A | N/A | System | `wireless` | Manages Wi-Fi Access Points. Handles SSIDs, authentication, and radio parameters. There is one `hostapd` process per radio/band. |
| **IGMP Proxy** | `igmpproxy` | N/A | IGMP | LAN/WAN | `igmpproxy` | Forwards IGMP multicast traffic between WAN and LAN for IPTV support. Config in `/etc/igmpproxy.conf`. Requires specific bridge/VLAN configuration for IPTV interfaces. Logs multicast group memberships. |
| **UPnP Service** | `miniupnpd` | 5000 | TCP/UDP | LAN | `miniupnp` | Enables automatic port forwarding for LAN devices. Security risk if enabled - allows internal devices to open external ports. Config in `/etc/miniupnpd.conf`. Check active mappings via `upnpc -l` or in Web UI. |
| **DDNS Updater** | `ddns-updater` | N/A | N/A | System | `ddns` | Updates external DNS records with router's dynamic WAN IP. Supports multiple providers. Config in `/etc/ddns_provider.conf`. Runs periodically via cron. Check `/var/log/ddns.log` for update status. |
| **FTP/FTPS** | `vsftpd` | 21, 990 | TCP | LAN/WAN | `ftpd` | File Transfer Protocol server. FTP is insecure (cleartext). FTPS (FTP over SSL) is available. Disabled by default. |
| **Telnet** | `telnetd` | 23 | TCP | LAN | `telnet` | Legacy remote access. **CRITICAL RISK.** Transmits credentials in cleartext. Must be disabled. |
| **WebDAV** | `httpd` | 5005, 5006 | TCP | LAN | `webdav` | Web-based file access protocol. Runs as part of Apache with WebDAV modules. |
| **Avahi** | `avahi-daemon` | 5353 | UDP | LAN | `avahi` | Linux implementation of mDNS/Bonjour for zero-configuration service discovery. |

## Service Dependencies and Relationships

Understanding the startup and dependency chain is critical for troubleshooting. A failure in a foundational service will cause a cascading failure in all dependent services.

### Core LAN & Management Service Chain

This chain illustrates how basic LAN connectivity and UI access are established.

```
syslog-ng (Logging)
└──> syno-net-setting (Applies interface IPs, bridges)
    └──> iptables (Loads firewall rules based on network config)
        └──> dnsmasq (Binds to configured LAN interface for DHCP/DNS)
            └──> httpd (Binds to configured interfaces for Web UI)
```

**Troubleshooting Logic:** If the Web UI is down, check `httpd`. If `httpd` is down, check if `dnsmasq` is running. If `dnsmasq` is failing, check if the LAN bridge (`br0`) has an IP and if `iptables` has loaded rules. If not, the root cause may be `syno-net-setting`. `syslog-ng` is the foundation for observing all of this.

### Outbound VPN Client Chain

This chain shows how the VPN client relies on the base network being established first.

```
syno-net-setting (Establishes base WAN/LAN connectivity)
└──> synovpnclient (Initiates connection to VPN provider)
    └──> iptables (VPN client scripts add policy routing rules to the firewall)
```

**Troubleshooting Logic:** If the VPN client fails to connect, first ensure the base WAN connection is up (`nslookup` test from the router). Then, check the `synovpnclient` logs. If it connects but traffic isn't routing correctly, inspect the output of `ip route` and `iptables-save` to see if the correct routing and firewall rules were applied.

## Startup Sequence and Timing

SRM follows a standard embedded Linux boot process, managed by the Upstart init system. The sequence is critical for understanding state transitions and troubleshooting boot-related failures.

1. **Bootloader (U-Boot):** Initializes the hardware (CPU, RAM, flash storage). It is not accessible to the user.
2. **Kernel Initialization:** The Linux kernel is loaded. It initializes drivers, mounts the root filesystem (often a read-only `squashfs`), and prepares the system to run user-space processes. Kernel messages can be viewed with the `dmesg` command.
3. **Init Process (`upstart`):** The kernel starts `/sbin/init`, which is the Upstart daemon. Upstart is event-based and begins processing job configuration files in `/etc/init/`.
4. **Core Service Start:** Upstart starts foundational services based on event emissions. This includes `syslog-ng`, mounting filesystems, and starting critical daemons like `dbus`.
5. **Synology Service Layer:** A key job started by Upstart is `syno-start.sh` or a similar master script. This script initiates the `synoservice` layer, which then starts all the higher-level services in an order that respects the dependencies we outlined earlier (e.g., `syno-net-setting` → `iptables` → `dnsmasq`).
6. **User-Space Ready:** Once `httpd` is started and listening, the SRM UI becomes available. This is typically one of the last core services to come online.

**Timing:** A full reboot to a ready state (UI accessible) typically takes 90-120 seconds. Service restarts via `synoservice` are much faster, usually taking 5-15 seconds depending on the service.

## Configuration Management

SRM uses a three-tier configuration system to ensure stability and prevent invalid states. Understanding this hierarchy is the most critical aspect of making persistent changes. Direct modification of system configuration files is strongly discouraged and will likely be overwritten.

1. **Default/Template Layer (`/usr/syno/etc.defaults/`)**
   - **Purpose:** Contains the "factory default" configuration files for services and packages.
   - **Operational Rule:** **NEVER EDIT FILES HERE.** This layer is a pristine source for templates. It is overwritten during firmware updates.

2. **Active/Generated Layer (`/etc/`)**
   - **Purpose:** Contains the live, running configuration files used by active services (e.g., `/etc/dnsmasq.conf`, `/etc/httpd/conf/httpd.conf`).
   - **Operational Rule:** **DO NOT EDIT FILES HERE DIRECTLY.** These files are dynamically generated by management daemons. Any manual changes will be lost when the service is restarted.

3. **User/Database Layer (UI and `synoservice`)**
   - **Purpose:** This is the abstraction layer where user intent is stored. Changes made in the SRM web interface are saved to a system database.
   - **Operational Rule:** **THIS IS THE ONLY SUPPORTED METHOD FOR MAKING CHANGES.**

**Example Flow for a DHCP Reservation:**
1. **User Layer:** You add a DHCP reservation in the SRM Web UI. The setting is saved to a system database.
2. **Management Daemon:** The `syno-net-setting` service detects the change.
3. **Active Layer:** It reads the new setting, combines it with other network settings, and generates a brand new `/etc/dnsmasq.conf` file.
4. **Service Control:** It then runs `synoservice --restart dnsmasq` to apply the new configuration.

## Network Topology Support

The behavior of core network services changes dramatically based on the configured operation mode. This is primarily controlled by the `syno-net-setting` service, which reconfigures interfaces and dependencies.

### Wireless Router Mode (Default)
- **Description:** The standard mode of operation. The device acts as a gateway, firewall, and DHCP/DNS server for the LAN.
- **Active Services:** All services listed in the inventory are potentially active. `dnsmasq` performs both DNS and DHCP. `iptables` performs NAT (masquerading) between WAN and LAN.

### Wireless AP (Access Point) / Bridge Mode
- **Description:** The device acts as a simple bridge, extending an existing network. All routing, DHCP, and firewall functions are deferred to the upstream router.
- **Key Service Changes:**
  - `dnsmasq`: DHCP server function is disabled
  - `iptables`: NAT is disabled
  - WAN Port: Reconfigured as an additional LAN port
  - **Impact:** Features like Threat Prevention, VPN server/client, and multi-gateway are non-functional

### Wireless Distribution System (WDS) / Mesh Point
- **Description:** The device acts as a mesh point, connecting wirelessly to a primary SRM router to extend Wi-Fi coverage.
- **Key Service Changes:** Similar to AP mode, but the "uplink" is a wireless interface rather than a wired one.

## Advanced Features

### IPTV Support

**Overview:** SRM provides dedicated IPTV support to ensure smooth multicast streaming from ISP-provided IPTV services without impacting regular network traffic.

**Key Components:**
- **IGMP Proxy (`igmpproxy`):** Forwards multicast group membership reports between WAN and designated LAN interfaces
- **Dedicated VLAN:** IPTV traffic is often segregated on a specific VLAN (configurable per ISP requirements)
- **Bridge Configuration:** Special bridge setup isolates IPTV traffic from regular LAN traffic

**Configuration:**
- **ISP Profiles:** Preconfigured profiles for major ISPs (stored in `/etc/iptv_type.conf`)
- **VLAN Tagging:** Automatic VLAN tag application based on ISP requirements
- **DHCP Option 60:** Some ISPs require specific DHCP client ID for STB authentication

**Operational Notes:**
- Check multicast group memberships: `cat /proc/net/igmp`
- Monitor IPTV traffic flow: `tcpdump -i br0 -n multicast`
- IPTV configuration changes require `synoservice --restart igmpproxy`

### Port Triggering and Forwarding

**Overview:** Dynamic port opening based on outbound traffic patterns, plus static port forwarding rules.

**Port Triggering:**
- **Daemon:** Monitors outbound connections on trigger ports
- **Action:** Temporarily opens incoming ports when trigger detected
- **Timeout:** Automatic closure after inactivity (default: 10 minutes)
- **Configuration:** Rules stored in SRM database, applied via iptables

**Port Forwarding:**
- **Static Rules:** Permanent NAT mappings
- **UPnP Integration:** If enabled, devices can request forwarding
- **Configuration:** Applied to FORWARD and nat tables
- **Security Note:** UPnP can pose security risks if compromised devices open unauthorized ports

### Traffic Monitoring and QoS

**Overview:** Real-time traffic monitoring with application-aware QoS ensures critical services get priority bandwidth.

**Key Components:**
- **Traffic Monitor Daemon:** Collects per-device and per-application statistics
- **Database Storage:** SQLite databases in `/volume1/@database/TrafficReport/` store historical data
- **Netfilter Integration:** Uses connection tracking and packet marking for classification

**QoS Implementation:**
- **HTB (Hierarchical Token Bucket):** Linux traffic control for bandwidth shaping
- **Application Detection:** DPI-based classification identifies traffic types
- **Priority Queues:** 
  - High: VoIP, gaming, management traffic
  - Medium: Web browsing, streaming
  - Low: File transfers, backups

**Operational Commands:**
- View QoS configuration: `tc -s qdisc show`
- Check traffic classes: `tc -s class show dev eth0`
- Monitor real-time marking: `iptables -t mangle -L -v -n`

### Auto-Blocking Mechanisms

**Overview:** Automated IP blocking for security threats and failed login attempts.

**Components:**
- **Detection:** Monitor auth logs for failed attempts
- **Blocking:** Uses ipset for efficient IP management
- **Thresholds:** Configurable attempts/time window (e.g., 5 attempts in 10 minutes)

**Management Commands:**
- View blocked IPs: `ipset list syno_auto_block`
- Unblock specific IP: `syno_iptables_common unblock <IP_ADDRESS>`
- **Caution:** Overly aggressive thresholds can lead to accidental lockout

### Multi-Gateway Support

**Overview:** Load balancing and failover across multiple WAN connections.

**Features:**
- **Policy-Based Routing:** Traffic distribution based on rules
- **Load Balancing:** Distributes new sessions across interfaces
- **Sticky Connections:** Maintains session consistency
- **Health Monitoring:** Ping-based gateway availability checks
- **Automatic Failover:** Seamless switching on failure

## Performance and Resource Usage

System resource consumption varies based on enabled features and traffic load:

| Feature/State | CPU Usage | RAM Usage | Notes |
| :--- | :--- | :--- | :--- |
| **Baseline (Idle)** | 5-10% | 300-400MB | Key processes: httpd, dnsmasq, hostapd |
| **Threat Prevention** | +30-50% | +100-200MB | Suricata is CPU/memory intensive |
| **VPN Server** | +10-20% per user | Varies | Scales with connections and traffic |
| **Traffic Monitoring** | +5-10% | Database growth | Continuous monitoring increases load |

**Performance Considerations:**
- Traffic monitoring databases can grow large; periodic cleanup recommended
- Multiple simultaneous features (VPN + Threat Prevention) compound resource usage
- Consider hardware limitations when enabling resource-intensive features

## Troubleshooting Guide

### Tier 1: Initial Triage

1. **Check Global Service Status:**
   - **Command:** `synoservice --status all`
   - **Purpose:** Lists all managed services and their current state

2. **Review System Logs:**
   - **Command:** `tail -f /var/log/messages`
   - **Purpose:** Live feed of main system log

3. **Check Network Interfaces:**
   - **Command:** `ifconfig` or `ip addr show`
   - **Purpose:** Verify interfaces are UP with correct IPs

### Tier 2: Connectivity & DNS Issues

1. **Inspect DHCP/DNS:**
   - **Command:** `tail -f /var/log/dnsmasq.log`
   - **Purpose:** Monitor DHCP leases and DNS queries

2. **Test Name Resolution:**
   - **Command:** `nslookup synology.com 8.8.8.8`
   - **Purpose:** Test router's external DNS resolution

3. **Verify Firewall Rules:**
   - **Command:** `iptables-save | less`
   - **Purpose:** Full firewall ruleset inspection

### Tier 3: Advanced Diagnostics

1. **Check Blocked IPs:**
   - **Command:** `ipset list`
   - **Purpose:** View auto-blocked IP addresses

2. **Kernel Messages:**
   - **Command:** `dmesg`
   - **Purpose:** Hardware-related issues and driver messages

## Security Hardening Checklist

1. **Change Default Credentials:** Immediately change default admin password
2. **Change Management Ports:** Move away from default 8000/8001
3. **Disable Unnecessary Services:** SSH, Telnet, SNMP, FTP if not needed
4. **Enable Auto-Block:** With reasonable thresholds
5. **Configure Firewall:** Default-deny policy with explicit allow rules
6. **Use VPN for Remote Management:** Never expose management interface to internet
7. **Enable 2FA:** For all administrator accounts
8. **Regular Firmware Updates:** Keep SRM and packages updated
9. **Disable UPnP:** Unless explicitly required by trusted devices
10. **Minimize Port Forwarding:** Regularly review and remove unnecessary rules

## Service Control Commands

All services are managed through the `synoservice` utility:

- **Check all services:** `synoservice --status all`
- **Check specific service:** `synoservice --status dnsmasq`
- **Stop service:** `synoservice --stop sshd`
- **Start service:** `synoservice --start sshd`
- **Restart service:** `synoservice --restart dnsmasq`
- **Reload service (graceful):** `synoservice --reload httpd`
- **Enable service (boot):** `synoservice --enable ftpd`
- **Disable service (boot):** `synoservice --disable ftpd`

## Maintenance Notes

### Best Practices
- Always use Web UI for configuration changes
- Document any CLI modifications
- Regular backup of configuration via UI
- Monitor system logs for anomalies
- Plan maintenance windows for service restarts

### Critical Warning
**Direct file edits will be lost on reboot/update.** Never edit configuration files directly (e.g., `/etc/dnsmasq.conf`, `/etc/httpd/conf/httpd.conf`). These files are regenerated from the system database at startup. Always use:
- Web UI for configuration
- `synoservice` for service management
- Official APIs for automation